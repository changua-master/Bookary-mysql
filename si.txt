if ($conn->connect_error) {
                echo '<div class="message error">Error de conexión con la base de datos</div>';
            }

            if ($_SERVER["REQUEST_METHOD"] == "POST") {
                $usuario = $_POST['username'];
                $contraseña_plana = $_POST['password'];

                // Validaciones básicas
                if (empty($usuario) || empty($contraseña_plana)) {
                    echo '<div class="message error">Por favor, complete todos los campos</div>';
                // Verificar si el usuario ya existe
                    $check_stmt = $conn->prepare("SELECT id FROM users WHERE username = ?");
                    if (!$check_stmt) {
                        echo '<div class="message error">Error en la consulta: ' . $conn->error . '</div>';
                    } else {
                        $check_stmt->bind_param("s", $usuario);
                        $check_stmt->execute();
                        $check_stmt->store_result();

                        if ($check_stmt->num_rows > 0) {
                            echo '<div class="message error">El nombre de usuario ya está en uso</div>';
                        } else {
                            $stmt = $conn->prepare("INSERT INTO users (username, password) VALUES (?, ?)");
                            if (!$stmt) {
                                echo '<div class="message error">Error en la consulta de inserción: ' . $conn->error . '</div>';
                            } else {
                                $stmt->bind_param("ss", $usuario, $contraseña_hash);

                                if ($stmt->execute()) {
                                    echo '<div class="message success">¡Registro exitoso! Bienvenido a Bookary</div>';
                                    echo '<script>
                                        document.getElementById("username").value = "";
                                        document.getElementById("contraseña").value = "";
                                    </script>';
                                } else {
                                    echo '<div class="message error">Error al crear la cuenta: ' . $stmt->error . '</div>';
                                }
                                $stmt->close();
                            }
                        }
                        $check_stmt->close();
                    }
                }
            }

            if (isset($conn)) {
                $conn->close();
            }
            ?>
        </div>

        <div class="footer">
            © 2025 Bookary - Todos los derechos reservados
        </div>
    </div>

    <script>
        
        document.querySelector('form').addEventListener('submit', function(e) {
            const usuario = document.getElementById('user').value.trim();
            const contraseña = document.getElementById('contraseña').value;
            
            if (usuario.length < 3) {
                e.preventDefault();
                alert('El nombre de usuario debe tener al menos 3 caracteres');
                return false;
            }
            
            if (contraseña.length < 6) {
                e.preventDefault();
                alert('La contraseña debe tener al menos 6 caracteres');
                return false;
            }
        });
        $password_hash = password_hash($password, PASSWORD_DEFAULT);